<article
  class="bg-white rounded-lg p-4 border border-[#F0F0F0] cursor-grab transition-all duration-200 ease-in-out relative hover:shadow-[0_4px_16px_rgba(0,0,0,0.10)] hover:border-[#D0D5DD] hover:-translate-y-px active:cursor-grabbing"
  [class.!bg-[#FFF8F8]]="task().priority === 'high' || task().priority === 'critical'"
  [class.border-l-[3px]]="task().priority === 'high' || task().priority === 'critical'"
  [class.border-l-[#E5484D]]="task().priority === 'high' || task().priority === 'critical'"
  [attr.aria-label]="'Task: ' + task().title"
>
  <!-- Priority badge + menu -->
  <div class="flex items-center justify-between mb-2">
    <span
      class="inline-block text-[0.65rem] font-bold py-0.5 px-2 rounded tracking-[0.5px]"
      [class.bg-[#FFE4E4]]="task().priority === 'high' || task().priority === 'critical'"
      [class.text-[#C0392B]]="task().priority === 'high' || task().priority === 'critical'"
      [class.bg-[#FFF3E0]]="task().priority === 'medium'"
      [class.text-[#E67E22]]="task().priority === 'medium'"
      [class.bg-[#E8F5E9]]="task().priority === 'low'"
      [class.text-[#27AE60]]="task().priority === 'low'"
      [attr.aria-label]="'Priority: ' + task().priority"
    >
      {{ (task().priority === 'critical' ? 'HIGH' : task().priority) | uppercase }}
    </span>
    <button
      mat-icon-button
      [matMenuTriggerFor]="menu"
      class="!w-7 !h-7 !leading-7 !bg-transparent border-none cursor-pointer p-0 rounded text-[#9E9E9E] flex items-center justify-center transition-all duration-150 hover:bg-[#F5F5F5] hover:text-[#333] focus-visible:outline-2 focus-visible:outline-[#1976D3]"
      aria-label="More options"
      type="button"
    >
      <mat-icon class="!text-[18px] !w-[18px] !h-[18px]">more_horiz</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="editRequested.emit(task())">
        <mat-icon>edit</mat-icon>
        <span>Edit</span>
      </button>
      <button mat-menu-item (click)="deleteRequested.emit(task().id)">
        <mat-icon class="text-danger">delete</mat-icon>
        <span>Delete</span>
      </button>
    </mat-menu>
  </div>

  <!-- Title & description -->
  <h3 class="text-[0.9rem] font-semibold text-[#1A1A2E] m-0 mb-1.5 leading-snug">
    {{ task().title }}
  </h3>
  @if (task().description) {
    <p class="text-[0.8rem] text-[#6B7280] m-0 mb-2.5 leading-relaxed line-clamp-2">
      {{ task().description }}
    </p>
  }

  <!-- Due date info -->
  @if (task().dueDate) {
    <div
      class="flex items-center gap-1 text-xs mb-2"
      [class.text-[#E5484D]]="isOverdue()"
      [class.text-[#6B7280]]="!isOverdue()"
    >
      @if (isOverdue()) {
        <mat-icon class="!text-[14px] !w-3.5 !h-3.5" aria-hidden="true">warning_amber</mat-icon>
        <span>Overdue</span>
      } @else if (task().status === 'done') {
        <mat-icon class="!text-[14px] !w-3.5 !h-3.5 text-[#27AE60]" aria-hidden="true"
          >check_circle</mat-icon
        >
        <span>Completed task</span>
      } @else {
        <mat-icon class="!text-[14px] !w-3.5 !h-3.5" aria-hidden="true">schedule</mat-icon>
        <span>Due {{ task().dueDate | date: 'MMM d' }}</span>
      }
    </div>
  }

  <!-- Tags -->
  @if (task().tags && task().tags!.length > 0) {
    <div class="flex flex-wrap gap-1 mb-2.5" aria-label="Tags">
      @for (tag of task().tags!; track tag) {
        <span class="text-[0.7rem] text-[#374151] bg-[#F3F4F6] rounded py-0.5 px-2">{{ tag }}</span>
      }
    </div>
  }

  <div class="h-px bg-[#F0F0F0] my-2"></div>

  <!-- Assignee avatar -->
  @if (task().assigneeName) {
    <div class="flex items-center gap-2">
      <div
        class="w-7 h-7 rounded-full bg-gradient-to-br from-[#667eea] to-[#764ba2] text-white flex items-center justify-center text-xs font-bold shrink-0"
        [attr.aria-label]="'Assigned to ' + task().assigneeName"
      >
        {{ task().assigneeAvatar }}
      </div>
      <span class="text-[0.8rem] text-[#6B7280] font-medium">@{{ task().assigneeName }}</span>
    </div>
  }
</article>
